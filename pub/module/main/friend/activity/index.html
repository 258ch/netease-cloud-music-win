<meta charset="utf-8"/> <textarea name="txt" id="m-revt-activity-module"> <div class="g-bd"> <div class="g-wrap q-lrc"> <div style="padding-top:1px;"><div class="u-load">载入中...</div></div> <div class="m-timeline"> <div class="m-timeact m-dlist j-flag"></div> <h2 class="smlhead s-fc3 f-dn j-flag">热门动态</h2> <ul class="m-dlist f-dn j-flag"></ul> <h2 class="smlhead s-fc3">所有动态</h2> <ul class="m-dlist j-flag"></ul> <div class="j-flag"></div> </div> </div> <div class="j-flag"></div> </div> </textarea> <textarea name="jst" id="m-revt-activity-info"> <div class="activity activity-detail f-pr f-cd" style="background-image:url(${coverPCLongUrl});"> ${commonJST('com-img', coverPCUrl, '760y276', 'f-img')} <span class="mask f-img f-pa"></span> <div class="title f-pa"> <h3 class="s-fc8 f-ff2">${title}</h3> </div> <div class="btnwrap f-pa"> <a data-action="participate" href="javascript:;" class="btn u-actbtn f-ff2">立即参与</a> </div> {if participateCount>=1000}<div class="number f-pa f-fs1 f-ff2 s-fc8">已参与人数：${participateCount}</div>{/if} </div> <ul class="cnt f-fs1 s-fc3"> {list text as t} <li>${t}</li> {/if} </ul> </textarea> <textarea name="js">(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bi=byz("nej.v"),bm=byz("nej.u"),bD=byz("nej.n"),bU=byz("nej.ut"),fH=byz("nej.cef"),cN=byz("nej.j"),bj=byz("nm.x"),bxI=byz("nm.i"),bR=byz("nm.l"),bp=byz("nm.d"),bY=byz("nm.m"),gD=byz("nm.w"),bC=byz("nm.m.r"),bTG=byz("nm.c"),byx,byD;bC.cOc=NEJ.C();byx=bC.cOc.bS(bY.cW);byx.byG=function(){this.bCU="m-revt-activity";this.dg();var bg=byA.bV(this.bA,"j-flag");this.Jy=bg[0];this.cOd=bg[1];this.cMY=bg[2];this.chD=bg[5];this.bMO=this.Jy.parentNode;this.caD=this.bMO.previousElementSibling;this.bL={limit:20,delta:30,sbody:null,parent:bg[3],item:{key:"id",klass:bxI.Sh,place:"activity"},pager:{parent:bg[4],clazz:"m-page m-page-wt"},cache:{klass:bp.kj,clear:true},onemptylist:this.bAe.byB(this,"暂无动态"),onafterlistload:this.bzK.byB(this),onbeforelistload:this.tH.byB(this),onbeforelistclear:this.bzb.byB(this),onpagechange:this.bzC.byB(this)}};byx.byT=function(blZ){this.cKg=bp.kj.bG();this.cmx(blZ);this.dO([[this.bA,"click",this.btw.byB(this)],[bTG.cvI,"publish_task_state_change",this.cOM.byB(this)]])};byx.eR=function(){this.byU();byA.bK(this.cOd,"f-dn");byA.bK(this.cMY,"f-dn");this.bUP()};byx.bUP=function(){if(this.cPV&&this.cPV.length){bxI.Sh.bQ(this.cPV)}delete this.cPV};byx.dq=function(blZ){this.dC(blZ);if(this.cw){this.cw=this.cw.bQ()}this.bL.cache.lkey="event_activity-list";this.bL.cache.data={actid:blZ.param.id};this.bL.sbody=byA.bV(document.body,"g-bd")[0];this.cw=bU.jN.bG(this.bL);cN.bzs(APP_CONF.domain+"/api/act/detail",{type:"json",query:{actid:blZ.param.id},onload:this.cOe.byB(this),onerror:this.cOe.byB(this)});this.bUP();cN.bzs(APP_CONF.domain+"/api/act/event/hot",{type:"json",query:{actid:blZ.param.id},onload:this.cPj.byB(this)});byA.bK(this.bMO,"f-dn");byA.bK(this.chD,"f-dn");byA.bJ(this.caD,"f-dn")};byx.ei=function(byy){var bk=bi.cR(byy,"d:action")};byx.tH=function(byy){var ep=byy.parent.children.length==0?"m-xwgt-white-loading":"m-xwgt-white-list-loading";byy.value=byA.gy(ep)};byx.bzC=function(){if(this.bL.sbody)this.bL.sbody.scrollTop=0};byx.cOe=function(byy){byA.bK(this.caD,"f-dn");var cE=byy.code;if(cE==200){byA.bJ(this.bMO,"f-dn");this.pm=byy.act;byA.eB(this.Jy,"m-revt-activity-info",NEJ.X({commonJST:ctl.commonJST.cFB},this.pm))}else if(cE==404){bj.sC();byy.stopped=true}else{byA.bK(this.bMO,"f-dn");byA.bJ(this.chD,"f-dn");this.ej(this,true,this.chD,"",{isPage:true})}};byx.btw=function(byy){var bk=bi.cR(byy,"d:action"),cX=byA.bT(bk,"action");switch(cX){case"participate":if(bj.btm()){bj.bNt();break}bi.bQd(byy);bR.cKq.bG({destroyable:true,actName:this.pm.title,actId:this.pm.actId,type:"activity",resourceType:this.pm.resourceType,resourceJson:this.pm.resourceJson||this.pm.resoruceJson}).dD()}};byx.cPj=function(byy){if(byy.code==200&&byy.events.length){this.cKg.hI("event_activity_hot",byy.events);this.cPV=byA.DP(byy.events,bxI.Sh,{parent:this.cMY,place:"activity"});byA.bJ(this.cOd,"f-dn");byA.bJ(this.cMY,"f-dn")}};byx.cOM=function(byy){if(byy.task.state==3&&byy.task.data.data.actId==this.pm.actId){this.pm.participateCount=Math.max(this.pm.participateCount,0)+1;byA.eB(this.Jy,"m-revt-activity-info",NEJ.X({commonJST:ctl.commonJST.cFB},this.pm));bj.ci({state:"success",txt:"分享成功"})}};bj.cU("/m/friend/activity",bC.cOc)})()</textarea>